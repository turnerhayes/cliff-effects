<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: programs/federal/snap.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: programs/federal/snap.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// DATA
import { UNDER13_CARE_EXPENSES, OVER12_CARE_EXPENSES } from '../../data/massachusetts/name-cores';
import { SNAPData } from '../../data/federal/2017/SNAPData';
import { federalPovertyGuidelines } from '../../data/federal/federalPovertyGuidelines';

// LOGIC/UTILITIES
import {
  sumProps,
  getGrossUnearnedIncomeMonthly,
} from '../../utils/cashflow';
import { getLimitBySize } from '../../utils/getGovData';
import { toMonthlyFrom } from '../../utils/convert-by-timescale';
import {
  getEveryMemberOfHousehold,
  getDependentMembers,
  isDisabled,
  getYoungerThan,
  getOlderThan,
} from '../../utils/getMembers';


/** Abstractions for main function calculations.
 *     Many aren't required, but make unit testing
 *     easier by taking away the need for unit tests
 *     to mess around with actual client values.
 *     Almost all require the `current` or `future`
 *     prop of the typical `client` object as an
 *     argument.
 * 
 * @namespace
 */
let SNAPhelpers = {},
    hlp         = SNAPhelpers;


/** Based on https://www.masslegalservices.org/SNAPCalculator.
 *     Bay State CAP not included as this prototype only deals with
 *     changes in earned income */
const getSNAPBenefits = function (fullClient, timeframe) {

  let client = fullClient[ timeframe ];

  let finalResult = 0,
      householdSize           = hlp.getHouseholdSize(client),
      grossIncomeTestResult   = hlp.passesGrossIncomeTest(client),
      netIncomeTestResult     = hlp.passesNetIncomeTest(client),
      maxSnapAllotment        = getLimitBySize(SNAPData.SNAP_LIMITS, householdSize),
      percentageOfNetIncome   = hlp.getNetIncome(client) * SNAPData.PERCENT_OF_NET,
      maxClientAllotment      = Math.max(0, maxSnapAllotment - percentageOfNetIncome);

  if (grossIncomeTestResult === true &amp;&amp; netIncomeTestResult === true) {

    if (maxClientAllotment &lt;= SNAPData.SMALL_HOUSEHOLD_MIN_GRANT) {
      if (householdSize &lt;= SNAPData.SMALL_HOUSEHOLD_SIZE) {
        finalResult = SNAPData.SMALL_HOUSEHOLD_MIN_GRANT;
      }

    } else {
      finalResult = maxClientAllotment;
    }

  }

  return finalResult;
}; // End getSNAPBenefits()


// =====================
// GROSS INCOME
// =====================

// Used in 1 other function, main function
/** Returns if SNAP-specific gross income is below
 *     a given amount. 
 * 
 * @todo must double checked in the documentation.
 *     Website uses `&lt;` for comparison, excel sheet
 *     uses `&lt;=` when comparing adjusted gross to
 *     poverty limit.
 * 
 * @memberof SNAPhelpers
 * @param {object} client
 * @returns {boolean}
 */
hlp.passesGrossIncomeTest = function (client) {
  let adjustedGross    = hlp.getAdjustedGross(client),
      grossIncomeLimit = hlp.getGrossIncomeLimit(client),
      passes           = null;

  if (hlp.hasDisabledOrElderlyMember(client)) {
    passes = true;
  } else {
    // `&lt;` in web calculator vs excel sheet `&lt;=`.
    if (adjustedGross &lt;= grossIncomeLimit) {
      passes = true;
    } else {
      passes = false;
    }
  }
  return passes;
};


// ======================
// NET INCOME
// ======================

// Used by main function
/** Returns if SNAP-specific net income is less than
 *     a maximum amount.
 * 
 * @memberof SNAPhelpers
 * @param {object} client
 * @returns {boolean}
 */
hlp.passesNetIncomeTest = function(client) {
  let maxNetIncome = hlp.getMaxNetIncome(client);

  if (maxNetIncome === `no limit`) {
    return true;
  } else if (hlp.getNetIncome(client) &lt; maxNetIncome) {
    return true;
  } else {
    return false;
  }

};

// Used by 1 function. Easier unit tests
/**
 * @memberof SNAPhelpers
 * @param {object} client
 * @returns {number|string}
 */
hlp.getMaxNetIncome = function (client) {
  // @todo Logic different in website calculator vs. excel sheet for this logic
  let adjustedGross           = hlp.getAdjustedGross(client),
      grossIncomeLimit        = hlp.getGrossIncomeLimit(client),
      disabledOrElderlyMember = hlp.hasDisabledOrElderlyMember(client);
  
  if ((adjustedGross &lt;= grossIncomeLimit) || !disabledOrElderlyMember) {
    return `no limit`;
  } else {
    return getLimitBySize(SNAPData.NET_INCOME_LIMITS, hlp.getHouseholdSize(client));
  }
};

// === getNetIncome ===

// Used in 2 functions
/** Returns SNAP-specific net income.
 * @memberof SNAPhelpers
 * @param {object} client
 * @returns {number}
 */
hlp.getNetIncome = function(client) {
  let adjustedIncome    = hlp.getAdjustedGrossMinusDeductions(client),
      // These two functions make unit testing much easier
      homelessDeduction = hlp.getHomelessDeduction(client),
      shelterDeduction  = hlp.getShelterDeduction(client);
  let extraDeductions   = homelessDeduction + shelterDeduction,
      afterDeductions   = adjustedIncome - extraDeductions;

  return Math.max(0, afterDeductions);
};

// *** getAdjustedGrossMinusDeductions ***

// Used in 2 functions
/**
 * @memberof SNAPhelpers
 * @param {object} client
 * @returns {number}
 */
hlp.getAdjustedGrossMinusDeductions = function (client) {
  let adjustedGross           = hlp.getAdjustedGross(client),
      standardDeduction       = hlp.getStandardDeduction(client),
      earnedIncomeDeduction   = hlp.getEarnedIncomeDeduction(client),
      medicalDeduction        = hlp.getMedicalDeduction(client),
      dependentCareDeduction  = hlp.getDependentCareDeduction(client);

  let adjustedIncome = adjustedGross - standardDeduction - earnedIncomeDeduction - medicalDeduction - dependentCareDeduction;
  return Math.max(0, adjustedIncome);
};

// Used in 1 other function. Easier unit tests
/** Returns standard SNAP deductions for a household
 *     of this size
 *
 * @memberof SNAPhelpers
 * @param {object} client
 * @returns {number}
 */
hlp.getStandardDeduction = function (client) {
  return getLimitBySize(SNAPData.STANDARD_DEDUCTIONS, hlp.getHouseholdSize(client));
};

// Used in 1 other function. Easier unit tests
/** Returns a SNAP-specific percentage of the client's
 *     earned income.
 *
 * @memberof SNAPhelpers
 * @param {object} client
 * @returns {number}
 */
hlp.getEarnedIncomeDeduction = function (client) {
  let totalMonthlyEarned = client.earned;
  return totalMonthlyEarned * SNAPData.PERCENT_GROSS_MONTHLY_EARNED;
};

// Used in 1 other function. Easier unit tests
/**
 * @memberof SNAPhelpers
 * @param {object} client
 * @returns {number}
 */
hlp.getMedicalDeduction = function (client) {
  let medicalDeduce = 0;

  if (hlp.hasDisabledOrElderlyMember(client) === true) {
    /** @todo Add disabledAssistance too. Also, otherMedical? */
    let medicalExpenses = client.disabledMedical;
    if ((medicalExpenses >= SNAPData.MIN_MEDICAL_EXPENSES) &amp;&amp; (medicalExpenses &lt;= SNAPData.MAX_MEDICAL_EXPENSES)) {
      medicalDeduce = SNAPData.STANDARD_MEDICAL_DEDUCTION;

    } else if (medicalExpenses >= SNAPData.MAX_MEDICAL_EXPENSES + 1) {
      medicalDeduce = medicalExpenses - SNAPData.MIN_MEDICAL_EXPENSES;

    }
  }  // end if has disabled or elderly

  return medicalDeduce;
};

// Used in 1 other function. Easier unit tests
/**
 * @memberof SNAPhelpers
 * @param {object} client
 * @returns {number}
 */
hlp.getDependentCareDeduction = function (client) {

  let dependentCare = 0;

  /** @todo Adopt https://github.com/codeforboston/cliff-effects/issues/264
   *     model for all these 'kinds' of 'if' situations. If possible. */
  if (getYoungerThan(client, 13).length > 0) {
    dependentCare += sumProps(client, UNDER13_CARE_EXPENSES);
  }

  let membersOver12    = getOlderThan(client, 12),
      dependentsOver12 = getDependentMembers(membersOver12);
  /** May want to test this the same way as Expenses step does. More consistent? */
  if (dependentsOver12.length > 0) {
    dependentCare += sumProps(client, OVER12_CARE_EXPENSES);
  }

  return dependentCare;
};

// *** getHomelessDeduction ***

// Used by 1 function. Candidate for merging.
/**
 * @memberof SNAPhelpers
 * @param {object} client
 * @returns {number}
 */
hlp.getHomelessDeduction = function(client) {
  if (hlp.isHomeless(client)) { 
    return SNAPData.HOMELESS_DEDUCTION; 
  }
  else { 
    return 0; 
  }
};

// *** getShelterDeduction ***

// Used by 1 function. Easier unit tests
// @todo Do they still get this deduction, even if they're homeless?
/** Returns deductions for those renting or owning a home.
 * @memberof SNAPhelpers
 * @param {object} client
 * @returns {number}
 */
hlp.getShelterDeduction = function(client) {

  let rawDeduction = hlp.getRawHousingDeduction(client);

  if (hlp.hasDisabledOrElderlyMember(client)) {
    return rawDeduction;
  } else {
    return Math.min(rawDeduction, SNAPData.SHELTER_DEDUCTION_CAP);
  }

};

// Used by 1 function. Easier unit tests
/** Returns deductions based on costs of owning or
 *     renting a living space and income amounts.
 *
 * @memberof SNAPhelpers
 * @param {object} client
 * @returns {number}
 */
hlp.getRawHousingDeduction = function(client) {
  let housingCosts        = hlp.getNonUtilityHousingCosts(client),
      utilityCosts        = hlp.getUtilityCostByBracket(client),
      totalHousingCost    = housingCosts + utilityCosts,
      halfAdjustedIncome  = hlp.getAdjustedGrossMinusDeductions(client) * 0.50,
      rawHousingDeduction = totalHousingCost - halfAdjustedIncome;

  return Math.max(0, rawHousingDeduction);
};

// Used by 1 function. Easier unit tests
/** Returns rent for renter or insurance + taxes for home owner.
 *
 * @todo: What about housing voucher?
 *
 * @memberof SNAPhelpers
 * @param {object} client
 * @returns {number}
 */
hlp.getNonUtilityHousingCosts = function(client) {
  let housingCost = null;

  if (hlp.isHomeless(client)) {
    housingCost = 0;
  } else if (client.housing === 'homeowner') {
    housingCost = client.mortgage + client.housingInsurance + client.propertyTax;
  } else if (client.housing === 'renter') {
    housingCost = client.rent;
  } else if (client.housing === 'voucher') {
    housingCost = client.rentShare;
  }

  return housingCost;
};

// Used by 1 function.  Easier unit tests
/**
 * @memberof SNAPhelpers
 * @param {object} client
 * @returns {number|string}
 */
hlp.getUtilityCostByBracket = function (client) {

  if (hlp.isHomeless(client)){
    return 0;

  } else {
    
    let utilityCategory = null;

    if (client.climateControl || client.fuelAssistance) {
      utilityCategory = 'Heating';
    } else if (client.nonHeatElectricity) {
      utilityCategory = 'Non-heating';
    } else if (client.phone) {
      utilityCategory = 'Telephone';
    } else {
      utilityCategory = 'Zero Utility Expenses';
    }

    return SNAPData.UTILITY_COST_BRACKETS[ utilityCategory ];
  }
};


// =====================
// SHARED INCOME CALCS
// =====================

// Used in 3 other functions
/** Returns all income minus child support paid out.
 * @memberof SNAPhelpers
 * @param {object} client
 * @returns {number}
 */
hlp.getAdjustedGross = function (client) {
  let raw = client.earned + getGrossUnearnedIncomeMonthly(client) - client.childSupportPaidOut;
  return Math.max(0, raw);
};

// Used in 2 other functions
/** Limit to gross income is based on client's household size.
 * @memberof SNAPhelpers
 * @param {object} client
 * @returns {number}
 */
hlp.getGrossIncomeLimit = function (client) {
  let data      = federalPovertyGuidelines,
      numPeople = hlp.getHouseholdSize(client),
      // Data is given in yearly amounts
      limit     = getLimitBySize(data, numPeople, 200),
      // Needs to be gov money rounded?
      monthly   = toMonthlyFrom(limit, 'yearly');
  return monthly;
};


// =====================
// SHARED MEMBER TESTS
// =====================

// Used by 5 other functions
/**
 * @memberof SNAPhelpers
 * @param {object} client
 * @returns {int}
 */
hlp.getHouseholdSize = function (client) {
  return client.household.length;
};

// Used in 4 other functions
/**
 * @memberof SNAPhelpers
 * @param {object} client
 * @returns {boolean}
 */
hlp.hasDisabledOrElderlyMember = function (client) {
  return getEveryMemberOfHousehold(client, hlp.isElderlyOrDisabled).length > 0;
};

// Used in 1 other function, but won't be created multiple times
/** Returns whether a member is elderly or disabled
 *     according to SNAP specifications (60 is elderly).
 *     Avoids multiple loops through household members
 *     and creating the function multiple times.
 *
 * @memberof SNAPhelpers
 * @param {object} member A household member
 * @returns {boolean}
 */
hlp.isElderlyOrDisabled = function (member) {
  // Age `60` counts as elderly for SNAP specifically
  return member.m_age >= 60 || isDisabled(member);
};

// Used in 3 other functions
/** Knows the right prop to access to determine
 *     if client is homeless. Prop name may change.
 *
 * @memberof SNAPhelpers
 * @param {object} client
 * @returns {boolean}
 */
hlp.isHomeless = function(client) {
  // Worth abstracting - used a few places and may change
  return client.housing === 'homeless';
};


export { getSNAPBenefits, SNAPhelpers };
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-formHelpers.html">formHelpers</a></li><li><a href="module-utils_charts_chartFormatting.html">utils/charts/chartFormatting</a></li><li><a href="module-utils_validators.html">utils/validators</a></li><li><a href="module-utils_valueFixers.html">utils/valueFixers</a></li></ul><h3>Classes</h3><ul><li><a href="App.html">App</a></li><li><a href="AskPermission.html">AskPermission</a></li><li><a href="BenefitsLinesComp.html">BenefitsLinesComp</a></li><li><a href="BrowserLeaveListener.html">BrowserLeaveListener</a></li><li><a href="CashFlowInputsRow.html">CashFlowInputsRow</a></li><li><a href="Confirmer.html">Confirmer</a></li><li><a href="ControlledRadioYesNo.html">ControlledRadioYesNo</a></li><li><a href="CustomClient.html">CustomClient</a></li><li><a href="ErrorListener.html">ErrorListener</a></li><li><a href="FeedbackPrompt.html">FeedbackPrompt</a></li><li><a href="HeadingWithDetail.html">HeadingWithDetail</a></li><li><a href="ManagedNumberField.html">ManagedNumberField</a></li><li><a href="ReactRouterLeaveListener.html">ReactRouterLeaveListener</a></li><li><a href="RowWithDetail.html">RowWithDetail</a></li><li><a href="ShowOnYes.html">ShowOnYes</a></li><li><a href="TermsAndConditions.html">TermsAndConditions</a></li><li><a href="VerticalLine.html">VerticalLine</a></li></ul><h3>Namespaces</h3><ul><li><a href="SNAPhelpers.html">SNAPhelpers</a></li></ul><h3>Global</h3><ul><li><a href="global.html#applyAndPushBenefits">applyAndPushBenefits</a></li><li><a href="global.html#applySideEffects">applySideEffects</a></li><li><a href="global.html#BottomRowButton">BottomRowButton</a></li><li><a href="global.html#CashFlowDisplayRow">CashFlowDisplayRow</a></li><li><a href="global.html#CashFlowRow">CashFlowRow</a></li><li><a href="global.html#CLIENT_DEFAULTS">CLIENT_DEFAULTS</a></li><li><a href="global.html#ColumnHeading">ColumnHeading</a></li><li><a href="global.html#ContentH1">ContentH1</a></li><li><a href="global.html#ContentSubH1">ContentSubH1</a></li><li><a href="global.html#convertForUpdate">convertForUpdate</a></li><li><a href="global.html#CurrentBenefitsContent">CurrentBenefitsContent</a></li><li><a href="global.html#CurrentBenefitsStep">CurrentBenefitsStep</a></li><li><a href="global.html#CurrentExpensesStep">CurrentExpensesStep</a></li><li><a href="global.html#CurrentIncomeStep">CurrentIncomeStep</a></li><li><a href="global.html#deepFreeze">deepFreeze</a></li><li><a href="global.html#DevMenu">DevMenu</a></li><li><a href="global.html#EarnedFrom">EarnedFrom</a></li><li><a href="global.html#empty">empty</a></li><li><a href="global.html#ExpensesFormContent">ExpensesFormContent</a></li><li><a href="global.html#ExternalLink">ExternalLink</a></li><li><a href="global.html#FormPartsContainer">FormPartsContainer</a></li><li><a href="global.html#getBenefitData">getBenefitData</a></li><li><a href="global.html#getBenefitTimeFrames">getBenefitTimeFrames</a></li><li><a href="global.html#getChartData">getChartData</a></li><li><a href="global.html#getDependentCostsMonthly">getDependentCostsMonthly</a></li><li><a href="global.html#getEveryMember">getEveryMember</a></li><li><a href="global.html#getEveryMemberOfHousehold">getEveryMemberOfHousehold</a></li><li><a href="global.html#getExtraAmount">getExtraAmount</a></li><li><a href="global.html#getGrossUnearnedIncomeMonthly">getGrossUnearnedIncomeMonthly</a></li><li><a href="global.html#getKeyPathsArray">getKeyPathsArray</a></li><li><a href="global.html#getKeyPathStrings">getKeyPathStrings</a></li><li><a href="global.html#getLimitBySize">getLimitBySize</a></li><li><a href="global.html#getLocalizationData">getLocalizationData</a></li><li><a href="global.html#getMaxIntKey">getMaxIntKey</a></li><li><a href="global.html#getSection8Benefit">getSection8Benefit</a></li><li><a href="global.html#getSimpleGrossIncomeMonthly">getSimpleGrossIncomeMonthly</a></li><li><a href="global.html#getSNAPBenefits">getSNAPBenefits</a></li><li><a href="global.html#getTextForLanguage">getTextForLanguage</a></li><li><a href="global.html#getUnder13Expenses">getUnder13Expenses</a></li><li><a href="global.html#Housing">Housing</a></li><li><a href="global.html#IncomeForm">IncomeForm</a></li><li><a href="global.html#inlineComponents">inlineComponents</a></li><li><a href="global.html#interpolateSnippets">interpolateSnippets</a></li><li><a href="global.html#interpolateText">interpolateText</a></li><li><a href="global.html#IntervalColumnHeadings">IntervalColumnHeadings</a></li><li><a href="global.html#isDependent">isDependent</a></li><li><a href="global.html#limit">limit</a></li><li><a href="global.html#maximum_value_yearly">maximum_value_yearly</a></li><li><a href="global.html#mergeCustomizer">mergeCustomizer</a></li><li><a href="global.html#moneyToWholeNum">moneyToWholeNum</a></li><li><a href="global.html#MonthlyCashFlowRow">MonthlyCashFlowRow</a></li><li><a href="global.html#Recursionisuntested.">Recursion is untested.</a></li><li><a href="global.html#round$">round$</a></li><li><a href="global.html#sampleClients">sampleClients</a></li><li><a href="global.html#SpaceHolder">SpaceHolder</a></li><li><a href="global.html#StackedBarGraph">StackedBarGraph</a></li><li><a href="global.html#sum">sum</a></li><li><a href="global.html#Summary">Summary</a></li><li><a href="global.html#sumProps">sumProps</a></li><li><a href="global.html#toMoneyStr">toMoneyStr</a></li><li><a href="global.html#toMonthlyFrom">toMonthlyFrom</a></li><li><a href="global.html#totalLastItemsOfArraysInObject">totalLastItemsOfArraysInObject</a></li><li><a href="global.html#toWeeklyFrom">toWeeklyFrom</a></li><li><a href="global.html#toYearlyFrom">toYearlyFrom</a></li><li><a href="global.html#undefinedString">undefinedString</a></li><li><a href="global.html#UNDER13_NON_TRANSPORT_CARE">UNDER13_NON_TRANSPORT_CARE</a></li><li><a href="global.html#UNEARNED_INCOME_SOURCES">UNEARNED_INCOME_SOURCES</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Nov 16 2018 20:50:22 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
