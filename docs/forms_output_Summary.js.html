<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: forms/output/Summary.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: forms/output/Summary.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// REACT COMPONENTS
import React from 'react';
import { Header, Button } from 'semantic-ui-react';

// DATA
// Colors and text for parts of the chart
import { PROGRAM_CHART_VALUES } from '../../utils/charts/PROGRAM_CHART_VALUES';

// DATA MANIPULATION
import { cloneDeep } from 'lodash';
import { toMoneyStr } from '../../utils/prettifiers';

// BENEFIT LOGIC
import { applyAndPushBenefits } from '../../programs/applyAndPushBenefits';


let EARNED_MONTHLY_INCREMENT_AMOUNT = 50;  // About a 25 cent raise in monthly amount for 40hrs/week?


/** Rounds money values, turns them into money-formatted
 *     strings, then removes trailing '.00'
 *
 * @param {number} number Number to round and format
 * @returns {string}
 */
let round$ = function (number) {
  return toMoneyStr(Math.round(number)).replace(`.00`, ``);
};


/** Looks at each array in an object, gets the
 *     last element of each, then adds those up 
 *
 * @param {object} accumulated
 * @param {array} accumulated.n Array of numbers
 * 
 * @returns {number} Total of all last numbers
 */
let totalLastItemsOfArraysInObject = function (accumulated) {
  let total = 0;
  for (let arrayName in accumulated) {
    let array = accumulated[ arrayName ];
    total += array[ array.length - 1 ];
  }
  return total;
};

/** Returns values representing earned income and benefit
 *     amounts at the given index, as well as the sum of all
 *     those benefits and the sum of the earned income and
 *     those benefits.
 *
 * @param {array} keys Contains keys to use on `sourceObject`.
 * @param {object} sourceObject MUST CONTAIN `earned` property!
 *     Contains `earned` and benefit keys that each have an
 *     array of numerical values (which are meant to be money
 *     values right now).
 * @param {array} sourceObject.earned Earned income values.
 * @param {int} Which item in each array should be used to
 *      accumulate values.
 *
 * @example
 * // In PROGRAM_CHART_VALUES.js
 * let PROGRAM_CHART_VALUES = {
 *  benefit1: { name: "B1" },
 *  benefit2: { name: "B2" },
 * };
 * 
 * // In here
 * let keys = [
 *  'benefit1',
 *  'benefit2',
 * ];
 *
 * let accumulated = {
 *  earned:   [ 450, 500 ],
 *  benefit1: [ 80, 30 ],
 *  benefit2: [ 40, 10 ],
 * };
 * 
 * let index = 1;
 * 
 * var summaryData = fillInMoneyValues(keys, accumulated, index);
 * 
 * console.log(summaryData);
 * // {
 * //   earned: 500,
 * //   benefits: [
 * //     { label: "B1", amount: 30 },
 * //     { label: "B2", amount: 10 }
 * //   ],
 * //   benefitsTotal: 40,
 * //   total: 540,
 * // }
 * 
 * Unfortunately, stll relies on an outside value -
 *     PROGRAM_CHART_VALUES.
 * 
 * @typedef {object} benefit
 * @property {string} label Name to be displayed for the benefit
 * @property {number} amount Value of the benefit/subsidy
 *
 * @typedef {object} moneyValues
 * @property {number} earned Amount earned at a given index
 * @property {array.&lt;benefit>} benefits
 * @property {number} benefitsTotal Sum of all benefit values at
 *     the given index
 * @property {number} total Sum of earned income and all benefits
 *     at the given index
 * 
 * @returns {object} moneyValues
 */
let fillInMoneyValues = (keys, sourceObject, index) => {

  if (!Array.isArray(sourceObject.earned)) {
    throw new TypeError(`The given resources object requires an 'earned' property that is an array of numbers.`);
  }

  let moneyValues = {
    earned:        0,
    benefits:      [],  // [{ label, amount }]
    benefitsTotal: 0,
    total:         0,
  };

  // Item names can be `earned` or benefit keys
  for (let itemKey of keys) {
    let amount = sourceObject[ itemKey ][ index ];

    if (itemKey === `earned`) {
      moneyValues.earned = amount;
    } else {
      moneyValues.benefits.push({
        label:  PROGRAM_CHART_VALUES[ itemKey ].name,
        amount: amount,
      });
      // Add up all benefits (we're not including earned income)
      moneyValues.benefitsTotal += amount;
    }
  }  // ends for every item key name

  moneyValues.total = moneyValues.earned + moneyValues.benefitsTotal;

  return moneyValues;
};  // Ends fillInMoneyValues()


/** Uses benefit data getter and reformats it to
 *     a format useful for identifying cliffs.
 *
 * @todo: find all cliffs, not just the closest?
 * 
 * @param {object} client `client` data with
 *     both `current` and `future`.
 * @param {Array.&lt;String>} resourceKeys List of...
 *     'programs'... in the order in which we eventually
 *     want to show them. It often also includes
 *     'earned' as the first value, so it's not a list
 *     of 'benefit programs' per se.
 *
 * @example
 * // NOTE: an example with a lower dip hasn't been found yet
 * // This example uses the sample `client` data from row 3,
 * // column 'clientData' here:
 * // https://docs.google.com/spreadsheets/d/15LyR9yELAfcngj-c7vMdI630b6DwuuXV-dQEJDvU4gE/edit?usp=sharing
 * var items = [ 'earned', 'section8', 'snap' ];
 * var data = getBenefitData(client, items);
 * console.log(data);
 * // {
 * //   current: {
 * //     benefits:[
 * //       { label: "Section 8 Housing", amount: 610 },
 * //       { label: "SNAP", amount: 49.93584000000004 },
 * //     ],
 * //     benefitsTotal: 659.9358400000001,
 * //     earned:        3398.1839999999997,
 * //     total:         4058.11984,
 * //   },
 * //   diff:   -43.873839999999745,
 * //   future: {
 * //     benefits: [
 * //       { label: "Section 8 Housing", amount: 607.402 }
 * //       { label: "SNAP", amount: 0 }
 * //     ],
 * //     benefitsTotal: 607.402,
 * //     earned:        3406.844,
 * //     total:         4014.246,
 * //   },
 * //   recovery: { total: 4084.246, earned: 3506.844 },
 * // }
 *
 * @returns {object}
 */
let getBenefitData = function(client, resourceKeys) {

  let clone  = cloneDeep(client),
      // This is the data we need in the groupings we need it
      result = {
        current:  null,  // current money values,
        future:   null,  // future money values,
        diff:     0,
        recovery: {},  // { total, earned, }
      },
      accumulated = {};

  // 1. Get current and future values
  let defaultProps = {
    activeBenefits: resourceKeys,
    dataToAddTo:    accumulated,
    clientToChange: clone,
    timeframe:      `current`,
  };
  let currentCalcData = defaultProps;
  applyAndPushBenefits(currentCalcData);
  let futureCalcData = { ...defaultProps, timeframe: `future` };
  applyAndPushBenefits(futureCalcData);
  // Now have: { earned: [c, f], n: [c, f], ... }

  // 2. Get totals
  // Fill earned values for both current and future earned objects
  result.current = fillInMoneyValues(resourceKeys, accumulated, 0);
  result.future  = fillInMoneyValues(resourceKeys, accumulated, 1);
  let resultCurr  = result.current,
      resultFutr  = result.future;

  // 3. Get difference between totals, partly to
  // see if we need to get cliff info.
  result.diff = resultFutr.total - resultCurr.total;

  // 4. If implicit taxes > 100% (has dramatic cliff)
  let recoveryAmount = 0,
      earned         = accumulated.earned;
  if (result.diff &lt;= 0) {
    // 5. The lowest point in their cliff is behind -
    // as is the nature of cliffs. Now try getting raises
    // till the client is making more money than they are now
    while (recoveryAmount - resultCurr.total &lt;= 0) {

      clone.future.earned += EARNED_MONTHLY_INCREMENT_AMOUNT;
      applyAndPushBenefits(futureCalcData);
      // If has dramatic cliff, must have recovery
      recoveryAmount = totalLastItemsOfArraysInObject(accumulated);

    }  // ends while making less money than now
    result.recovery.total  = recoveryAmount;
    result.recovery.earned = earned[ earned.length - 1 ];

  }  // ends if hit dramatic cliff

  return result;
};  // Ends getBenefitData()


/** Plain text output of how benefits will be affected.
 *
 * @todo When implemented, add in the factor of total
 *     expenses. Some changes will have to happen to
 *     make the output more useful. If expenses are still
 *     covered, that should be pointed out, otherwise
 *     they should be told when their expenses will be
 *     covered again.
 * @todo Add link for how to find a case manager.
 * @todo Look even further forward and make sure there
 *     aren't more cliffs immediately after this round.
 * @todo When there's no cliff, look ahead to see if
 *     there will be one soon/later?
 *     'What more should I know?' section?
 * @todo Is there a program that has a very steep slope
 *     instead of a cliff? One where the losses grow over
 *     time for a while?
 */
const Summary = function ({ client, openFeedback, snippets }) {

  const resourceKeys = [
    `earned`,
    ...client.current.benefits,
  ];

  // Really quick returns if other calcs not needed
  if (resourceKeys.length &lt;= 1) {
    return snippets.i_noBenefitsChosen;
  }
  if (client.future.earned === client.current.earned) {
    return snippets.i_noFutureChange;
  }


  // Otherwise do some logic magic!
  let data = getBenefitData(client, resourceKeys);

  let {
    current,  // { earned, benefits: [{ label, amount }], benefitsTotal, total }
    future,   // same
    diff,
    recovery, // { total, earned, }
  } = data;

  let sn = snippets;

  // ==================  
  // WARNING: WHITESPACE IS VERY IMPORTANT HERE. Read about JSX whitespace.
  // ==================
  // Hmm, don't like having `&lt;p>`s up here. Page structure not clear in return value.

  // `&lt;span>`s to avoid repeating React keys

  // "What could happen?"
  let detailsNow = (
    &lt;p>
      &lt;span>{sn.i_nowEarn} {sn.i_beforeMoneyWithTime}{toMoneyStr(current.earned)} {sn.i_eachTimeInterval}&lt;/span>
      &lt;span>{` `} {sn.i_nowBenefitsTotalIs} {sn.i_beforeMoneyWithTime}{round$(current.benefitsTotal)}{sn.i_period}&lt;/span>
      &lt;span>{` `} {sn.i_nowTotalIs} {sn.i_beforeMoneyWithTime}{round$(current.total)} {sn.i_eachTimeInterval}{sn.i_period}&lt;/span>
    &lt;/p>
  );

  let detailsFuture = (
    &lt;p>
      &lt;span>{sn.i_newEarn} {sn.i_beforeMoneyWithTime}{toMoneyStr(future.earned)} {sn.i_eachTimeInterval}&lt;/span>
      &lt;span>{` `} {sn.i_newBenefitsTotalIs} {sn.i_beforeMoneyWithTime}{round$(future.benefitsTotal)} {sn.i_eachTimeInterval}{sn.i_period}&lt;/span>
      &lt;span>{` `} {sn.i_newBenefitDetailsIntro}&lt;/span>
    &lt;/p>
  );

  // List of benefits html list items
  let benefitList = [];
  let numBenefits = current.benefits.length;
  for (let benefiti = 0; benefiti &lt; numBenefits; benefiti++) {

    let cBenefit = current.benefits[ benefiti ],
        fBenefit = future.benefits[ benefiti ];

    benefitList.push(
      &lt;li key = { cBenefit.label }>
        &lt;span>{cBenefit.label} {sn.i_from} {sn.i_beforeMoneyWithTime}{round$(cBenefit.amount)}&lt;/span>
        &lt;span>{` `} {sn.i_to} {sn.i_beforeMoneyWithTime}{round$(fBenefit.amount)} {sn.i_eachTimeInterval}{sn.i_period}&lt;/span>
      &lt;/li>
    );
  }  // ends for each benefit

  // Ask for feedback
  // Stays put when printing. A take-home hint
  // that the tool is still a prototype
  let feedbackAsk = (
    &lt;p>
      &lt;span key = { `pre-ask` }>
        { snippets.i_feedbackAsk }
      &lt;/span>
      &lt;Button
        compact
        key     = { `ask` }
        size    = { `small` }
        onClick = { openFeedback }>
        { snippets.i_submitFeedback }
      &lt;/Button>
    &lt;/p>
  );

  // Describe how totals change
  let posDiff    = round$(Math.abs(diff)),
      lessOrMore = ``;
  if (diff > 0) {
    lessOrMore = &lt;span>{sn.i_resultIs} {sn.i_beforeMoneyWithTime}{posDiff} {sn.i_moreThan}&lt;/span>;
  } else if (diff &lt; 0) {
    lessOrMore = &lt;span>{sn.i_resultIs} {sn.i_beforeMoneyWithTime}{posDiff} {sn.i_lessThan}&lt;/span>;
  } else if (diff === 0) {
    lessOrMore = &lt;span>{sn.i_resultIs} {sn.i_sameAs}&lt;/span>;
  }

  let summaryFuture = (
    &lt;p>{sn.i_newTotalIs} {sn.i_beforeMoneyWithTime}{round$(future.total)} {sn.i_eachTimeInterval}{sn.i_period} {lessOrMore}&lt;/p>
  );

  let endOfCliffContent = sn.i_noCliff;
  // If there was a cliff, how much more will they have
  // to earn before they'll get more than they are now?
  if (recovery.total !== undefined) {
    endOfCliffContent = (
      &lt;div>
        &lt;div className = { `text-result-section` }>
          &lt;Header>{sn.i_cliffEndHeader}&lt;/Header>
          &lt;p>
            &lt;span>{sn.i_ifGetTo} {sn.i_beforeMoneyWithTime}{round$(recovery.earned)} {sn.i_eachTimeInterval}&lt;/span>
            &lt;span>{` `} {sn.i_willGet} {sn.i_beforeMoneyWithTime}{round$(recovery.total - current.total)}&lt;/span>
            &lt;span>{` `} {sn.i_moreIn}&lt;/span>
          &lt;/p>
        &lt;/div>

        &lt;hr />
        &lt;p>{sn.i_findHelp}&lt;/p>
      &lt;/div>
    );
  }  // ends if there's a cliff end

  const print = function () {
    window.print();
  };

  return (
    &lt;div>

      &lt;div className = { `text-result-section` }>
        &lt;Header>{sn.i_detailsHeader}&lt;/Header>
        { detailsNow }
        { detailsFuture }
        &lt;ul>
          { benefitList }
        &lt;/ul>
        { feedbackAsk }
      &lt;/div>

      &lt;div className = { `text-result-section` }>
        &lt;Header>{sn.i_summaryHeader}&lt;/Header>
        { summaryFuture }
      &lt;/div>
      
      { endOfCliffContent }

      &lt;div className={ `print-row` } >
        &lt;Button
          className = { `print` }
          color     = { `teal` }
          onClick   = { print }>
          { sn.i_printButton }
        &lt;/Button>
      &lt;/div>

    &lt;/div>
  );
};  // Ends &lt;Summary>


export {
  Summary,
  totalLastItemsOfArraysInObject,
  fillInMoneyValues,
  getBenefitData,  
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-formHelpers.html">formHelpers</a></li><li><a href="module-utils_charts_chartFormatting.html">utils/charts/chartFormatting</a></li><li><a href="module-utils_validators.html">utils/validators</a></li><li><a href="module-utils_valueFixers.html">utils/valueFixers</a></li></ul><h3>Classes</h3><ul><li><a href="App.html">App</a></li><li><a href="AskPermission.html">AskPermission</a></li><li><a href="BenefitsLinesComp.html">BenefitsLinesComp</a></li><li><a href="BrowserLeaveListener.html">BrowserLeaveListener</a></li><li><a href="CashFlowInputsRow.html">CashFlowInputsRow</a></li><li><a href="Confirmer.html">Confirmer</a></li><li><a href="ControlledRadioYesNo.html">ControlledRadioYesNo</a></li><li><a href="CustomClient.html">CustomClient</a></li><li><a href="ErrorListener.html">ErrorListener</a></li><li><a href="FeedbackPrompt.html">FeedbackPrompt</a></li><li><a href="HeadingWithDetail.html">HeadingWithDetail</a></li><li><a href="ManagedNumberField.html">ManagedNumberField</a></li><li><a href="ReactRouterLeaveListener.html">ReactRouterLeaveListener</a></li><li><a href="RowWithDetail.html">RowWithDetail</a></li><li><a href="ShowOnYes.html">ShowOnYes</a></li><li><a href="TermsAndConditions.html">TermsAndConditions</a></li><li><a href="VerticalLine.html">VerticalLine</a></li></ul><h3>Namespaces</h3><ul><li><a href="SNAPhelpers.html">SNAPhelpers</a></li></ul><h3>Global</h3><ul><li><a href="global.html#applyAndPushBenefits">applyAndPushBenefits</a></li><li><a href="global.html#applySideEffects">applySideEffects</a></li><li><a href="global.html#BottomRowButton">BottomRowButton</a></li><li><a href="global.html#CashFlowDisplayRow">CashFlowDisplayRow</a></li><li><a href="global.html#CashFlowRow">CashFlowRow</a></li><li><a href="global.html#CLIENT_DEFAULTS">CLIENT_DEFAULTS</a></li><li><a href="global.html#ColumnHeading">ColumnHeading</a></li><li><a href="global.html#ContentH1">ContentH1</a></li><li><a href="global.html#ContentSubH1">ContentSubH1</a></li><li><a href="global.html#convertForUpdate">convertForUpdate</a></li><li><a href="global.html#CurrentBenefitsContent">CurrentBenefitsContent</a></li><li><a href="global.html#CurrentBenefitsStep">CurrentBenefitsStep</a></li><li><a href="global.html#CurrentExpensesStep">CurrentExpensesStep</a></li><li><a href="global.html#CurrentIncomeStep">CurrentIncomeStep</a></li><li><a href="global.html#deepFreeze">deepFreeze</a></li><li><a href="global.html#DevMenu">DevMenu</a></li><li><a href="global.html#EarnedFrom">EarnedFrom</a></li><li><a href="global.html#empty">empty</a></li><li><a href="global.html#ExpensesFormContent">ExpensesFormContent</a></li><li><a href="global.html#ExternalLink">ExternalLink</a></li><li><a href="global.html#FormPartsContainer">FormPartsContainer</a></li><li><a href="global.html#getBenefitData">getBenefitData</a></li><li><a href="global.html#getBenefitTimeFrames">getBenefitTimeFrames</a></li><li><a href="global.html#getChartData">getChartData</a></li><li><a href="global.html#getDependentCostsMonthly">getDependentCostsMonthly</a></li><li><a href="global.html#getEveryMember">getEveryMember</a></li><li><a href="global.html#getEveryMemberOfHousehold">getEveryMemberOfHousehold</a></li><li><a href="global.html#getExtraAmount">getExtraAmount</a></li><li><a href="global.html#getGrossUnearnedIncomeMonthly">getGrossUnearnedIncomeMonthly</a></li><li><a href="global.html#getKeyPathsArray">getKeyPathsArray</a></li><li><a href="global.html#getKeyPathStrings">getKeyPathStrings</a></li><li><a href="global.html#getLimitBySize">getLimitBySize</a></li><li><a href="global.html#getLocalizationData">getLocalizationData</a></li><li><a href="global.html#getMaxIntKey">getMaxIntKey</a></li><li><a href="global.html#getSection8Benefit">getSection8Benefit</a></li><li><a href="global.html#getSimpleGrossIncomeMonthly">getSimpleGrossIncomeMonthly</a></li><li><a href="global.html#getSNAPBenefits">getSNAPBenefits</a></li><li><a href="global.html#getTextForLanguage">getTextForLanguage</a></li><li><a href="global.html#getUnder13Expenses">getUnder13Expenses</a></li><li><a href="global.html#Housing">Housing</a></li><li><a href="global.html#IncomeForm">IncomeForm</a></li><li><a href="global.html#inlineComponents">inlineComponents</a></li><li><a href="global.html#interpolateSnippets">interpolateSnippets</a></li><li><a href="global.html#interpolateText">interpolateText</a></li><li><a href="global.html#IntervalColumnHeadings">IntervalColumnHeadings</a></li><li><a href="global.html#isDependent">isDependent</a></li><li><a href="global.html#limit">limit</a></li><li><a href="global.html#maximum_value_yearly">maximum_value_yearly</a></li><li><a href="global.html#mergeCustomizer">mergeCustomizer</a></li><li><a href="global.html#moneyToWholeNum">moneyToWholeNum</a></li><li><a href="global.html#MonthlyCashFlowRow">MonthlyCashFlowRow</a></li><li><a href="global.html#Recursionisuntested.">Recursion is untested.</a></li><li><a href="global.html#round$">round$</a></li><li><a href="global.html#sampleClients">sampleClients</a></li><li><a href="global.html#SpaceHolder">SpaceHolder</a></li><li><a href="global.html#StackedBarGraph">StackedBarGraph</a></li><li><a href="global.html#sum">sum</a></li><li><a href="global.html#Summary">Summary</a></li><li><a href="global.html#sumProps">sumProps</a></li><li><a href="global.html#toMoneyStr">toMoneyStr</a></li><li><a href="global.html#toMonthlyFrom">toMonthlyFrom</a></li><li><a href="global.html#totalLastItemsOfArraysInObject">totalLastItemsOfArraysInObject</a></li><li><a href="global.html#toWeeklyFrom">toWeeklyFrom</a></li><li><a href="global.html#toYearlyFrom">toYearlyFrom</a></li><li><a href="global.html#undefinedString">undefinedString</a></li><li><a href="global.html#UNDER13_NON_TRANSPORT_CARE">UNDER13_NON_TRANSPORT_CARE</a></li><li><a href="global.html#UNEARNED_INCOME_SOURCES">UNEARNED_INCOME_SOURCES</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Nov 16 2018 20:50:22 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
